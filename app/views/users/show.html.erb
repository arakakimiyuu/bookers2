
<div class="container px-5 px-sm-0">
  <div class="row">

    <%= render 'books/list', book: @newbook, user: @user %>
    <div class="col-md-8 offset-md-1">
      <h2>Books</h2>
      <table class="table table-hover table-inverse">
    　<thead>
      <tr>
        <th></th>
        <th>Title</th>
        <th>Opinion</th>
        <th colspan="3"></th>
      </tr>
    　</thead>
    　<tbody>
        <% @books.each do |book| %>
        <tr>
          <td>
            <%= link_to user_path(@user) do %>
             <%= image_tag book.user.get_profile_image %>
            <% end %>
          </td>
          <td><%= link_to book.title, book_path(book.id) %></td>
          <td><%= book.body %></td>
          <td id="favorite-btn_<%= book.id %>">
           <%= render 'favorites/favorite-btn', book: book %>
          </td>
        </tr>
        <% end %>
    　</tbody>
    　<div>
    　  <%#現在ログインしているユーザーではないという条件式 %>
          　<% unless @user.id == current_user.id %>
        　   <%# 相互フォロー状態のときの条件式%>
            <% if (current_user.following? @user) && (@user.following? current_user) %>
            <%#コントローラーと同様にすでにチャットルームが作成されている時とされていない時の条件分岐をさせるため、@isRoomを使用 %>
            <%#@isRoomがtrueの時は、チャットボタンを出現させすでに作成されたチャットへと移行する %>
            <% if @isRoom == true %>
              <p class="user-show-room"><a href="/rooms/<%= @roomId %>" class="btn btn-primary btn-lg">チャットへ</a>
            <% else %>
              <%= form_for @room do |f| %>
                <%= fields_for @entry do |e| %>
                  <%#Entriesテーブルのレコードにはuser_idを送る必要があるので、hidden_field（隠しフィールドの作成）で@user.idをvalueにおく %>
                  <%= e.hidden_field :user_id, value: @user.id %>
                <% end %>
                <%= f.submit "チャットを始める", class:"btn btn-primary btn-lg user-show-chat"%>
              <% end %>
            <% end %>
            <% end %>
          <% end %>
    　</div>
    　</table>
    </div>
  </div>
</div>